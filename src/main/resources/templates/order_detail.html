<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{./include/userBaseLayout :: setContent( ~{:: .wrap} ) }">
  <div class="wrap">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>아메리카노 주문</title>
      <link rel="stylesheet" href="/css/order_detail.css">


    </head>
    <body>

    <main>
      <div class="coffee-img"><img src="/images/image2.png" alt="아메리카노"></div>
      <h1>아메리카노</h1>
      <p class="desc">
        진하게 추출한 에스프레소에 시원한 정제수를 더한 클래식 커피<br>
        깔끔한 뒷맛과 시원한 청량감으로 <br>
        언제 어디서나 부담 없이 즐길 수 있습니다
      </p>

      <form name="orderDetailForm" action="orderComplete" method="post">
        <div class="section">
          <div class="menu-info" id="detailBtn">메뉴 상세 정보 <span>›</span></div>
          <div class="segmented-wrap">
            <div class="segmented" role="tablist" aria-label="Temperature">
              <button type="button" class="segmented-btn" data-value="ice" role="tab" aria-selected="false" tabindex="0">ICE</button>
              <button type="button" class="segmented-btn active" data-value="hot" role="tab" aria-selected="true" tabindex="0">HOT</button>
              <span class="segmented-thumb" aria-hidden="true"></span>
            </div>
          </div>

          <label class="tumbler">
                <input type="checkbox" id="tumbler" name="tumbler" value="Y"> 텀블러에 주문할게요
              </label>

              <div class="option-btn" id="shotBtn">샷 선택 <span>›</span></div>
              <div class="option-btn" id="sweetBtn">당도 선택 <span>›</span></div>
              <div class="option-btn" id="toppingBtn">토핑 선택 <span>›</span></div>

              <div class="quantity">
                <div>
                  <button class="qty-btn" id="minus">-</button>
                  <span id="qty">1</span>
                  <input type="hidden" name="amount" id="qtyInput" value="1">

                  <button class="qty-btn" id="plus">+</button>
                </div>
                <div class="price" id="price">2500원</div>
              </div>

              <div class="actions">
                <button class="add">담기</button>
                <button class="order">주문하기</button>
              </div>
            </div>
        </main>


        <!-- 상세정보 모달 -->
        <div class="modal-bg" id="detailModal">
          <div class="modal">
            <div class="modal-header"><h3>메뉴 상세 정보</h3><span class="close">✕</span></div>
            <div class="info-row"><span>용량</span><span>710ml</span></div>
            <div class="info-row"><span>칼로리</span><span>12kcal</span></div>
            <div class="info-row"><span>탄수화물</span><span>1.6g</span></div>
            <div class="info-row"><span>단백질</span><span>1.0g</span></div>
            <div class="info-row"><span>지방</span><span>0.2g</span></div>
            <div class="info-row"><span>나트륨</span><span>1.5mg</span></div>
            <div class="info-row"><span>카페인</span><span>199.7mg</span></div>
          </div>
        </div>

        <!-- 공통 모달 -->
        <div class="modal-bg" id="optionModal">
          <div class="modal">
            <div class="modal-header"><h3 id="optionTitle">옵션 선택</h3><span class="close">✕</span></div>
            <div id="optionContent">
              <input type="hidden" name="shot" id="shotInput" value="0">
              <input type="hidden" name="vanillaSyrup" id="vanillaInput" value="0">
              <input type="hidden" name="cream" id="creamInput" value="0">

            </div>
            <div id="optionFooter" style="margin-top:16px; text-align:right;">
              <button type="button" id="applyOptionBtn" style="padding:6px 12px; border-radius:5px; cursor:pointer;">적용하기</button>
            </div>
          </div>
        </div>
      </form>

    <script>
      // DOM
      const segmented = document.querySelector('.segmented');
      const buttons = Array.from(document.querySelectorAll('.segmented-btn'));
      const thumb = document.querySelector('.segmented-thumb');

      // 초기 상태: active 버튼이 있는 쪽을 클래스로 표기
      function updateContainerClass() {
        const active = buttons.find(b => b.classList.contains('active'));
        if (!active) return;
        if (active.dataset.value === 'ice') {
          segmented.classList.add('left');
          segmented.classList.remove('right');
        } else {
          segmented.classList.add('right');
          segmented.classList.remove('left');
        }
      }
      updateContainerClass();

      // 클릭 처리
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          buttons.forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-selected', 'false');
          });
          btn.classList.add('active');
          btn.setAttribute('aria-selected', 'true');

          // (옵션) 현재 선택값을 콘솔에 출력하거나 다른 작업에 사용
          console.log('선택:', btn.dataset.value);
          updateContainerClass();
        });

        // 키보드 접근성: 좌/우 화살표로 이동, Enter/Space로 선택
        btn.addEventListener('keydown', (e) => {
          const idx = buttons.indexOf(btn);
          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
            e.preventDefault();
            const prev = buttons[(idx - 1 + buttons.length) % buttons.length];
            prev.focus();
          } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
            e.preventDefault();
            const next = buttons[(idx + 1) % buttons.length];
            next.focus();
          } else if (e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            btn.click();
          }
        });
      });


      let appliedOptionCounts = {};
      const pricePer = 2500;
      const optionPrice = 500;
      let qty = 1;
      const qtyEl = document.getElementById('qty');
      const priceEl = document.getElementById('price');
      document.getElementById('plus').onclick = () => { qty++; updatePrice(); };
      document.getElementById('minus').onclick = () => { if (qty>1) qty--; updatePrice(); };
      function updatePrice() {
        qtyEl.textContent = qty;

        let optionTotal = 0;
        for (const key in appliedOptionCounts) {
          optionTotal += appliedOptionCounts[key] * optionPrice;
        }

        const total = (qty * pricePer) + optionTotal;
        priceEl.textContent = total.toLocaleString() + '원';
      }


      // 모달
      const detailModal = document.getElementById('detailModal');
      const optionModal = document.getElementById('optionModal');
      const applyBtn = document.getElementById('applyOptionBtn');

      applyBtn.onclick = () => {
        // 모든 옵션 row를 돌면서 수량을 저장
        document.querySelectorAll('#optionContent .option-row').forEach(row => {
          const name = row.querySelector('span').textContent;
          const val = parseInt(row.querySelector('.val').textContent);
          appliedOptionCounts[name] = val;
        });

        updatePrice();           // 총액 갱신
        optionModal.style.display = 'none'; // 모달 닫기
      };

      document.getElementById('detailBtn').onclick = () => openModal(detailModal);
      document.getElementById('shotBtn').onclick = () => openOption('샷 선택', ['샷 추가']);
      document.getElementById('sweetBtn').onclick = () => openOption('당도 선택', ['바닐라 시럽 추가']);
      document.getElementById('toppingBtn').onclick = () => openOption('토핑 선택', ['휘핑 크림 추가']);

      function openModal(modal) {
        modal.style.display = 'flex';
        modal.querySelector('.close').onclick = () => modal.style.display = 'none';
        modal.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };
      }

      const optionTitle = document.getElementById('optionTitle');
      const optionContent = document.getElementById('optionContent');
      function openOption(title, items) {
        optionTitle.textContent = title;

        optionContent.innerHTML = items.map(item => {
          // 기존 선택값 불러오기
          let val = appliedOptionCounts[item] || 0;
          return `
      <div class='option-row'>
        <span>${item}</span>
        <div class='opt-controls'>
          <span>500원</span>
          <button onclick='adjust(this,-1)'>-</button>
          <span class='val'>${val}</span>
          <button onclick='adjust(this,1)'>+</button>
        </div>
      </div>
    `;
        }).join('');

        openModal(optionModal);
      }


      function adjust(btn, delta) {
        const valEl = btn.parentElement.querySelector('.val');
        let v = parseInt(valEl.textContent);
        v = Math.max(0, v + delta);
        valEl.textContent = v;

      }
    </script>
    </body>
    </html>

  </div>
</th:block>
</html>


